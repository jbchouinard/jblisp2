(import "stl/unittest" as ut)

(ut::test-suite "lang"
    (ut::test "asserting false things raises"
        (ut::assert-raise (assert false)))

    (ut::test "not true is false"
        (ut::assert-equal true (not false)))

    (ut::test "string is string" 
        (ut::assert-type "foo" string))

    (ut::test "nil is nil"
        (ut::assert-eq () (list)))

    (ut::test "true is true"
        (ut::assert-eq (not false) (not false)))

    (ut::test "list is pair"
        (assert (pair? (list 1 2 3))))

    (ut::test "pair is pair"
        (assert (pair? (cons 1 2))))

    (ut::test "list is list"
        (assert (list? (list 1 2 3))))

    (ut::test "pair is not list"
        (ut::assert-not (list? (cons 1 2))))

    (ut::test "let bindings"
        (ut::assert-equal 110
            (let x 100
            (let y 10
                (+ x y)))))

    (ut::test "set! unbound raises error"
        (ut::assert-raise (set! unbound)))

    (ut::test "set! changes local binding"
        (ut::assert-equal 7 (
            let x 0
                (set! x 7)
                x)))

    (ut::test "eval a quoted sexpr" 
        (assert (eval (quote (eq? nil nil)))))

    (ut::test "apply"
        (ut::assert-equal 6 (apply + (list 1 2 3))))

    (ut::test "map"
        (ut::assert-equal
            (list 2 4 6)
            (map (fn (x) (* 2 x)) (list 1 2 3))))

    (ut::test "fold"
        (ut::assert-equal
            (list 4 3 2 1)
            (fold cons () (list 1 2 3 4))))

    (defn varia-car (x . xs) x)

    (defn varia-cdr (x . xs) xs)

    (defn varia-list (. xs) xs)

    (ut::test "variadic parameters 1"
        (ut::assert-equal (varia-car 1 2 3) 1))

    (ut::test "variadic parameters 2"
        (ut::assert-equal (varia-cdr 1 2 3) (list 2 3)))

    (ut::test "variadic parameters 3"
        (ut::assert-equal (varia-cdr 1) ()))

    (ut::test "variadic parameters 4"
        (ut::assert-equal (varia-list 1 2 3) (list 1 2 3)))

    (defn varia-let () (let x 12 "no-bueno" x))

    (ut::test "variadic let"
        (ut::assert-equal (varia-let) 12)))
